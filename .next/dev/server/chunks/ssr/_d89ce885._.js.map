{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/hector/Desktop/WHOLESALE%20AI/v0-ai-wholesaling-agent/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\"\nimport { cookies } from \"next/headers\"\n\nexport async function createClient() {\n  const cookieStore = await cookies()\n\n  return createServerClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!, {\n    cookies: {\n      getAll() {\n        return cookieStore.getAll()\n      },\n      setAll(cookiesToSet) {\n        try {\n          cookiesToSet.forEach(({ name, value, options }) => cookieStore.set(name, value, options))\n        } catch {\n          // Server Component - ignore\n        }\n      },\n    },\n  })\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe;IACpB,MAAM,cAAc,MAAM,IAAA,iTAAO;IAEjC,OAAO,IAAA,4SAAkB,sUAAoF;QAC3G,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,YAAY,GAAG,CAAC,MAAM,OAAO;gBAClF,EAAE,OAAM;gBACN,4BAA4B;gBAC9B;YACF;QACF;IACF;AACF"}},
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///Users/hector/Desktop/WHOLESALE%20AI/v0-ai-wholesaling-agent/lib/lead-actions.ts"],"sourcesContent":["\"use server\"\n\nimport { createClient } from \"@/lib/supabase/server\"\nimport type { Lead, Message } from \"@/lib/types\"\nimport { revalidatePath } from \"next/cache\"\n\nexport async function createLead(data: {\n  name: string\n  phone_number: string\n  address: string\n  state?: string\n  notes?: string\n  arv?: number\n  repair_estimate?: number\n}): Promise<{ lead: Lead | null; error: string | null }> {\n  const supabase = await createClient()\n\n  // Format phone number (ensure it starts with +1 for US)\n  let phone = data.phone_number.replace(/\\D/g, \"\")\n  if (phone.length === 10) {\n    phone = `+1${phone}`\n  } else if (phone.length === 11 && phone.startsWith(\"1\")) {\n    phone = `+${phone}`\n  } else if (!phone.startsWith(\"+\")) {\n    phone = `+${phone}`\n  }\n\n  function extractState(addr: string): string | null {\n    try {\n      const parts = addr.split(\",\").map((p) => p.trim().toUpperCase())\n      for (const p of parts.reverse()) {\n        const m = p.match(/\\b([A-Z]{2})\\b/)\n        if (m) return m[1]\n      }\n      return null\n    } catch {\n      return null\n    }\n  }\n\n  const state = data.state || extractState(data.address || \"\")\n\n  const { data: lead, error } = await supabase\n    .from(\"leads\")\n    .insert({\n      name: data.name,\n      phone_number: phone,\n      address: data.address,\n      state: state || null,\n      notes: data.notes || null,\n      arv: data.arv || null,\n      repair_estimate: data.repair_estimate || null,\n      conversation_state: \"cold_lead\",\n    })\n    .select()\n    .single()\n\n  if (error) {\n    console.error(\"Error creating lead:\", error)\n    return { lead: null, error: error.message }\n  }\n\n  revalidatePath(\"/dashboard\")\n  return { lead: lead as Lead, error: null }\n}\n\nexport async function updateLead(\n  id: string,\n  data: Partial<Lead>,\n): Promise<{ lead: Lead | null; error: string | null }> {\n  const supabase = await createClient()\n\n  const { data: lead, error } = await supabase\n    .from(\"leads\")\n    .update({ ...data, updated_at: new Date().toISOString() })\n    .eq(\"id\", id)\n    .select()\n    .single()\n\n  if (error) {\n    console.error(\"Error updating lead:\", error)\n    return { lead: null, error: error.message }\n  }\n\n  revalidatePath(\"/dashboard\")\n  return { lead: lead as Lead, error: null }\n}\n\nexport async function getLeadByPhone(phone: string): Promise<Lead | null> {\n  const supabase = await createClient()\n\n  // Normalize phone number\n  let normalizedPhone = phone.replace(/\\D/g, \"\")\n  if (normalizedPhone.length === 10) {\n    normalizedPhone = `+1${normalizedPhone}`\n  } else if (normalizedPhone.length === 11 && normalizedPhone.startsWith(\"1\")) {\n    normalizedPhone = `+${normalizedPhone}`\n  } else if (!normalizedPhone.startsWith(\"+\")) {\n    normalizedPhone = `+${normalizedPhone}`\n  }\n\n  const { data, error } = await supabase.from(\"leads\").select(\"*\").eq(\"phone_number\", normalizedPhone).single()\n\n  if (error || !data) {\n    return null\n  }\n\n  return data as Lead\n}\n\nexport async function getLeadById(id: string): Promise<Lead | null> {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase.from(\"leads\").select(\"*\").eq(\"id\", id).single()\n\n  if (error || !data) {\n    return null\n  }\n\n  return data as Lead\n}\n\nexport async function getAllLeads(): Promise<Lead[]> {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase.from(\"leads\").select(\"*\").order(\"updated_at\", { ascending: false })\n\n  if (error) {\n    console.error(\"Error fetching leads:\", error)\n    return []\n  }\n\n  return data as Lead[]\n}\n\nexport async function saveMessage(data: {\n  lead_id: string\n  direction: \"inbound\" | \"outbound\"\n  content: string\n  twilio_sid?: string\n  model_used?: Message[\"model_used\"]\n  was_escalated?: boolean\n}): Promise<{ message: Message | null; error: string | null }> {\n  const supabase = await createClient()\n\n  const { data: message, error } = await supabase\n    .from(\"messages\")\n    .insert({\n      lead_id: data.lead_id,\n      direction: data.direction,\n      content: data.content,\n      twilio_sid: data.twilio_sid || null,\n      model_used: data.model_used || null,\n      was_escalated: data.was_escalated || false,\n    })\n    .select()\n    .single()\n\n  if (error) {\n    console.error(\"Error saving message:\", error)\n    return { message: null, error: error.message }\n  }\n\n  // Update lead's last_message_at\n  await supabase.from(\"leads\").update({ last_message_at: new Date().toISOString() }).eq(\"id\", data.lead_id)\n\n  return { message: message as Message, error: null }\n}\n\nexport async function getLeadMessages(leadId: string): Promise<Message[]> {\n  const supabase = await createClient()\n\n  const { data, error } = await supabase\n    .from(\"messages\")\n    .select(\"*\")\n    .eq(\"lead_id\", leadId)\n    .order(\"created_at\", { ascending: true })\n\n  if (error) {\n    console.error(\"Error fetching messages:\", error)\n    return []\n  }\n\n  return data as Message[]\n}\n\nexport async function deleteLead(id: string): Promise<{ error: string | null }> {\n  const supabase = await createClient()\n\n  const { error } = await supabase.from(\"leads\").delete().eq(\"id\", id)\n\n  if (error) {\n    console.error(\"Error deleting lead:\", error)\n    return { error: error.message }\n  }\n\n  revalidatePath(\"/dashboard\")\n  return { error: null }\n}\n\nexport async function checkDatabaseSetup(): Promise<boolean> {\n  const supabase = await createClient()\n\n  try {\n    // Try to query the leads table with a minimal query\n    const { error } = await supabase.from(\"leads\").select(\"id\").limit(1)\n    return !error\n  } catch {\n    return false\n  }\n}\n\nexport async function bulkImportLeads(\n  leads: Array<{\n    name: string\n    phone_number: string\n    address: string\n    state?: string\n    notes?: string\n    arv?: number\n    repair_estimate?: number\n  }>,\n): Promise<{ successCount: number; failedCount: number; errors: string[] }> {\n  const supabase = await createClient()\n  let successCount = 0\n  let failedCount = 0\n  const errors: string[] = []\n\n  for (const leadData of leads) {\n    // Format phone number\n    let phone = leadData.phone_number.replace(/\\D/g, \"\")\n    if (phone.length === 10) {\n      phone = `+1${phone}`\n    } else if (phone.length === 11 && phone.startsWith(\"1\")) {\n      phone = `+${phone}`\n    } else if (!phone.startsWith(\"+\")) {\n      phone = `+${phone}`\n    }\n\n    // Check if lead already exists\n    const { data: existing } = await supabase.from(\"leads\").select(\"id\").eq(\"phone_number\", phone).single()\n\n    if (existing) {\n      errors.push(`Lead with phone ${leadData.phone_number} already exists`)\n      failedCount++\n      continue\n    }\n\n    function extractState(addr: string): string | null {\n      try {\n        const parts = addr.split(\",\").map((p) => p.trim().toUpperCase())\n        for (const p of parts.reverse()) {\n          const m = p.match(/\\b([A-Z]{2})\\b/)\n          if (m) return m[1]\n        }\n        return null\n      } catch {\n        return null\n      }\n    }\n    const st = leadData.state || extractState(leadData.address || \"\")\n\n    const { error } = await supabase.from(\"leads\").insert({\n      name: leadData.name,\n      phone_number: phone,\n      address: leadData.address,\n      state: st || null,\n      notes: leadData.notes || null,\n      arv: leadData.arv || null,\n      repair_estimate: leadData.repair_estimate || null,\n      conversation_state: \"cold_lead\",\n    })\n\n    if (error) {\n      errors.push(`Failed to import ${leadData.name}: ${error.message}`)\n      failedCount++\n    } else {\n      successCount++\n    }\n  }\n\n  revalidatePath(\"/dashboard\")\n  return { successCount, failedCount, errors }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 312, "column": 0}, "map": {"version":3,"sources":["file:///Users/hector/Desktop/WHOLESALE%20AI/v0-ai-wholesaling-agent/.next-internal/server/app/dashboard/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getAllLeads as '008cdb6014397a9a0b1e19644ca2f7451678dc0ad2'} from 'ACTIONS_MODULE0'\nexport {checkDatabaseSetup as '00bb13a43ee43226ea5b2c5bcc44556ffab22e3772'} from 'ACTIONS_MODULE0'\nexport {bulkImportLeads as '400876d000890621df8d17c326fcbdceb8d4ee1bba'} from 'ACTIONS_MODULE0'\nexport {getLeadMessages as '407b3643e0db615a3a64c3ac08cba1e0131ad45349'} from 'ACTIONS_MODULE0'\nexport {deleteLead as '409e649377e69c96635a34147215cdcdec47201fa6'} from 'ACTIONS_MODULE0'\nexport {saveMessage as '40a18a9991d81dd72c702511e17777aeec1e55219a'} from 'ACTIONS_MODULE0'\nexport {getLeadByPhone as '40c627b2be23930d27c553249090c14679426c8414'} from 'ACTIONS_MODULE0'\nexport {getLeadById as '40ccaebbd1af21b19bcea04e8052037119515f9947'} from 'ACTIONS_MODULE0'\nexport {createLead as '40f268df870143d3475a1971753d69d5095e440ded'} from 'ACTIONS_MODULE0'\nexport {updateLead as '608c97ce5c1e9e7af3dd0625f786fb2c36986cc4a9'} from 'ACTIONS_MODULE0'\nexport {createLead as '40f268df870143d3475a1971753d69d5095e440ded'} from 'ACTIONS_MODULE0'\nexport {bulkImportLeads as '400876d000890621df8d17c326fcbdceb8d4ee1bba'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}