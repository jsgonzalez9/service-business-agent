module.exports=[15794,e=>{"use strict";e.i(86864);var t=e.i(77058),n=e.i(55156);function i(e){return Math.sqrt(e.reduce((e,t)=>e+t*t,0))}async function r(e){let n=new t.default({apiKey:process.env.OPENAI_API_KEY});return(await n.embeddings.create({model:"text-embedding-3-small",input:e})).data[0].embedding}async function a(e,t,d,s=.85,c){let o=(0,n.createServiceClient)(),u=await r(t),l=o.from("cached_responses").select("id,response_text,embedding,intent,market,usage_count,created_at").eq("intent",e);d&&(l=l.eq("market",d));let{data:m}=await l.limit(200),f=Date.now(),g="number"==typeof c&&c>0?24*c*36e5:void 0,_=(m||[]).filter(e=>!g||f-new Date(e.created_at).getTime()<=g).map(e=>{var t;let n,r;return{id:e.id,text:e.response_text,score:(t=e.embedding||[],n=i(u),r=i(t),n&&r?function(e,t){let n=0;for(let i=0;i<Math.min(e.length,t.length);i++)n+=e[i]*t[i];return n}(u,t)/(n*r):0)}});_.sort((e,t)=>t.score-e.score);let p=_[0];if(p&&p.score>=s){let e=(m||[]).find(e=>e.id===p.id);return await o.from("cached_responses").update({usage_count:(e?.usage_count||0)+1,last_used_at:new Date().toISOString()}).eq("id",p.id),{text:p.text,confidence:p.score,id:p.id}}return{text:null,confidence:0}}e.s(["embedQuery",()=>r,"findCachedByEmbedding",()=>a])}];

//# sourceMappingURL=lib_llm-cache_ts_f9e4bce6._.js.map