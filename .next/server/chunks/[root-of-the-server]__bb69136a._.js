module.exports=[18622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},24725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},93695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},89660,e=>{"use strict";e.i(94879);var t=e.i(87022),r=e.i(93458);async function a(){let e=await (0,r.cookies)();return(0,t.createServerClient)("http://localhost:54321","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxvY2FsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDQwNjcyMDAsImV4cCI6MjAxOTY0MzIwMH0.local",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:a})=>e.set(t,r,a))}catch{}}}})}e.s(["createClient",()=>a])},14747,(e,t,r)=>{t.exports=e.x("path",()=>require("path"))},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},22734,(e,t,r)=>{t.exports=e.x("fs",()=>require("fs"))},32721,e=>{"use strict";var t=e.i(74461),r=e.i(89660);let a=process.env.TWILIO_ACCOUNT_SID,n=process.env.TWILIO_AUTH_TOKEN,o=process.env.TWILIO_PHONE_NUMBER,s=process.env.TWILIO_CALLER_ID,i=(process.env.TWILIO_NUMBER_POOL||"").split(",").map(e=>e.trim()).filter(e=>e.length>0),l=Number(process.env.SMS_MONTHLY_LIMIT_PER_NUMBER||1e4);async function c(){let e=i.length>0?i:o?[o]:[];if(0===e.length)return[];try{let t,a=await (0,r.createClient)(),{data:n}=await a.from("call_events").select("event_data, created_at").eq("event_type","sms_sent").gte("created_at",((t=new Date).setDate(1),t.setHours(0,0,0,0),t.toISOString())),o={};for(let e of n||[]){let t=e.event_data?.from;"string"==typeof t&&(o[t]=(o[t]||0)+1)}return e.filter(e=>(o[e]||0)<l).sort((e,t)=>(o[e]||0)-(o[t]||0))}catch{return e}}function u(){return a&&n?(0,t.default)(a,n):(console.warn("Twilio credentials not configured"),null)}function d(){if(s&&s.length>0)return s;let e=i.length>0?i:o?[o]:[];return e.length>0?e[0]:null}async function p(e,t,a){let n=u();if(!n){let r=a?.withFooter??!0?"\n\nReply STOP to unsubscribe":"",n=`${t}${r}`;return console.log(`[MOCK SMS] To: ${e}
Message: ${n}`),{sid:`mock_${Date.now()}`,error:null}}let o=Number(process.env.SMS_QUIET_HOURS_START||8),s=Number(process.env.SMS_QUIET_HOURS_END||21),i=new Date().getHours();if(i<o||i>=s)return{sid:null,error:"Quiet hours active; message not sent"};if(!a?.bypassSuppression)try{let t=await (0,r.createClient)(),a=e.replace(/\D/g,"");10===a.length?a=`+1${a}`:11===a.length&&a.startsWith("1")?a=`+${a}`:a.startsWith("+")||(a=`+${a}`);let{data:n}=await t.from("leads").select("*").eq("phone_number",a).single();if(n&&n.is_opted_out)return{sid:null,error:"Recipient has opted out"}}catch{}let l=await c();if(0===l.length)return{sid:null,error:"No available Twilio sender number (check pool or config)"};try{try{let e=await (0,r.createClient)(),t=new Date(Date.now()-6e4).toISOString(),{count:a}=await e.from("sms_events").select("id",{count:"exact",head:!0}).gte("created_at",t),n=Number(process.env.SMS_RATE_LIMIT_PER_MIN||25);if((a||0)>=n)return{sid:null,error:"Rate limit exceeded, try later"}}catch{}let o=[];try{let e=await (0,r.createClient)(),{data:t}=await e.from("agent_config").select("*").limit(1).single(),a=t?.company_name||"Your Company";o.push(`${a}: real estate lead generation`)}catch{o.push("Real estate lead generation")}o.push("Msg & data rates may apply"),o.push("Reply HELP for help"),o.push("Reply STOP to unsubscribe");let s=o.join(" â€¢ "),i=a?.withFooter??!0?`

${s}`:"",c=`${t}${i}`,u=null;for(let a of l)try{let o=await n.messages.create({body:c,from:a,to:e,statusCallback:"http://localhost:3000/api/twilio/status"});try{let n=await (0,r.createClient)();await n.from("sms_events").insert({sid:o.sid,to_number:e,from_number:a,status:"sent",error:null,body:t})}catch{}return{sid:o.sid,error:null}}catch(e){u=e?.message?String(e.message):"Failed to send SMS";continue}try{let a=await (0,r.createClient)();await a.from("sms_events").insert({sid:null,to_number:e,from_number:l[0],status:"failed",error:u||"Failed to send SMS",body:t})}catch{}return{sid:null,error:u||"Failed to send SMS"}}catch(e){return console.error("Error sending SMS:",e),{sid:null,error:e instanceof Error?e.message:"Failed to send SMS"}}}function f(e,r,a){return!n||t.default.validateRequest(n,e,r,a)}e.s(["chooseCallerId",()=>d,"eligibleNumbersSorted",()=>c,"getTwilioClient",()=>u,"sendSMS",()=>p,"validateTwilioRequest",()=>f])},97953,(e,t,r)=>{"use strict";t.exports=e.r(42315).vendored["react-rsc"].ReactServerDOMTurbopackServer},45015,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"registerServerReference",{enumerable:!0,get:function(){return a.registerServerReference}});let a=e.r(97953)},95975,(e,t,r)=>{"use strict";function a(e){for(let t=0;t<e.length;t++){let r=e[t];if("function"!=typeof r)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof r}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"ensureServerEntryExports",{enumerable:!0,get:function(){return a}})},76296,e=>{"use strict";var t=e.i(45015);e.i(94879);var r=e.i(87022),a=e.i(93458),n=e.i(95975);let o=(0,r.createServerClient)("http://localhost:54321",process.env.SUPABASE_SERVICE_ROLE_KEY,{cookies:{getAll:async()=>(await (0,a.cookies)()).getAll(),setAll:async e=>{let t=await (0,a.cookies)();e.forEach(({name:e,value:r,options:a})=>{t.set(e,r,a)})}}});async function s(e,t){try{let{data:r,error:a}=await o.from("calls").insert({lead_id:e,call_type:t,call_status:"pending"});if(a)return console.error("[Voice Calls] Create error:",a),null;return r?r[0]:null}catch(e){return console.error("[Voice Calls] Unexpected error:",e),null}}async function i(e,t){try{let{data:r,error:a}=await o.from("calls").update(t).eq("id",e).select();if(a)return console.error("[Voice Calls] Update error:",a),null;return r?r[0]:null}catch(e){return console.error("[Voice Calls] Unexpected error:",e),null}}async function l(e){try{let{data:t,error:r}=await o.from("calls").select("*").eq("lead_id",e).order("created_at",{ascending:!1});if(r)return console.error("[Voice Calls] Get error:",r),[];return t||[]}catch(e){return console.error("[Voice Calls] Unexpected error:",e),[]}}async function c(e,t,r){try{await o.from("call_events").insert({call_id:e,event_type:t,event_data:r})}catch(e){console.error("[Call Events] Error:",e)}}async function u(e){try{let{data:t,error:r}=await o.from("calls").select("*").eq("id",e).single();if(r||!t)return null;return t}catch(e){return console.error("[Voice Calls] Get by id error:",e),null}}async function d(e,t,r){try{let a=await s(e,"outbound");if(!a)return void console.error(`[Voice Call] Failed to create call record for lead: ${e}`);if(await c(a.id,"call_intent_detected",{intent_status:t,scheduled_time:r,triggered_at:new Date().toISOString()}),console.log(`[Voice Call Triggered] Call ID: ${a.id}, Lead ID: ${e}, Status: ${t}`),r)await c(a.id,"call_scheduled",{scheduled_time:r});else if("warm_call_requested"===t||"ready_for_offer_call"===t)try{let r=await fetch("http://localhost:3000/api/twilio/voice/outbound",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leadId:e,callIntentStatus:t})});r.ok||console.error("[Voice Call] Outbound call API failed:",await r.text())}catch(e){console.error("[Voice Call] Error initiating outbound call:",e)}}catch(t){console.error(`[Voice Call] Error triggering voice call for lead ${e}:`,t)}}(0,n.ensureServerEntryExports)([s,i,l,c,u,d]),(0,t.registerServerReference)(s,"60a48c9085876d4a600acfd394232b63b598fa8531",null),(0,t.registerServerReference)(i,"601c1d8e60c5b222ca1e315a95e06acbef3e78d5a8",null),(0,t.registerServerReference)(l,"408dd28cf017bc7f615fda799ebf19e9888698353a",null),(0,t.registerServerReference)(c,"70043ac9b7b65bded1e4e5a75630a41608d32299d3",null),(0,t.registerServerReference)(u,"40597c66ab8e249508fd641b5fb7b67ed449022c27",null),(0,t.registerServerReference)(d,"70b91e4c974ce4af98dce25267449343cb41d3c5fb",null),e.s(["addCallEvent",()=>c,"createCall",()=>s,"getCallById",()=>u,"triggerVoiceCall",()=>d,"updateCall",()=>i])},53828,e=>{"use strict";var t=e.i(89660);let r={maxCallMinutes:Number(process.env.MAX_CALL_MINUTES||10),vadEnabled:"true"===String(process.env.VOICE_VAD_ENABLED||"false").toLowerCase(),audioQuality:"medium",concurrencyLimit:3,senderMonthlyLimit:Number(process.env.SENDER_MONTHLY_LIMIT||2e3)};async function a(){try{let e=await (0,t.createClient)(),{data:a}=await e.from("call_events").select("event_data, created_at").eq("event_type","settings_update").order("created_at",{ascending:!1}).limit(1),n=a?.[0]?.event_data||{};return{maxCallMinutes:"number"==typeof n.maxCallMinutes?n.maxCallMinutes:r.maxCallMinutes,vadEnabled:"boolean"==typeof n.vadEnabled?n.vadEnabled:r.vadEnabled,audioQuality:n.audioQuality||r.audioQuality,concurrencyLimit:"number"==typeof n.concurrencyLimit?n.concurrencyLimit:r.concurrencyLimit,senderMonthlyLimit:"number"==typeof n.senderMonthlyLimit?n.senderMonthlyLimit:r.senderMonthlyLimit}}catch{return r}}e.s(["getRuntimeSettings",()=>a])},34718,e=>{"use strict";var t=e.i(47909),r=e.i(74017),a=e.i(96250),n=e.i(59756),o=e.i(61916),s=e.i(14444),i=e.i(37092),l=e.i(69741),c=e.i(16795),u=e.i(87718),d=e.i(95169),p=e.i(47587),f=e.i(66012),m=e.i(70101),h=e.i(26937),g=e.i(10372),y=e.i(93695);e.i(52474);var v=e.i(5232),w=e.i(89171),_=e.i(74461),x=e.i(54233),C=e.i(76296),R=e.i(53828);e.i(89228);let S=new(e.i(91601)).default({apiKey:process.env.OPENAI_API_KEY}),b=`You are an AI voice agent for a real estate wholesaling company. Your job is to have natural, professional conversations with property owners via phone calls.

YOUR ROLE:
- For OUTBOUND calls: Introduce yourself professionally and ask if they're interested in selling their property
- For INBOUND calls: Answer warmly and confirm they're open to discussing a sale
- Qualify the lead through natural conversation
- Discuss property details, condition, timeline, and motivation
- Present fair cash offers based on data
- Schedule follow-ups or next steps
- Always be respectful of their time

CRITICAL RULES:
1. Keep responses SHORT and conversational (1-2 sentences max for voice)
2. Use simple, clear language - no jargon
3. Ask open-ended questions to understand their situation
4. Be ready to handle objections gracefully
5. If they say "no" or "not interested", thank them and end the call professionally
6. Never pressure or be pushy
7. For offers: Frame as "fair cash offer" not "low ball"
8. If call gets technical: Explain in simple terms or offer callback
9. Track timeline, motivation, property condition through conversation
10. Offer contract link or next call as close

CONVERSATION FLOW:
- Greeting & Introduction (5-10 seconds)
- Quick Qualification (property details, timeline, condition)
- Offer Presentation (if qualified)
- Close (next steps, follow-up, or contract)

Keep the conversation natural and human-like. Don't sound robotic.`;async function E(e,t,r){try{let r=await S.chat.completions.create({model:"gpt-5.1",max_tokens:150,messages:[{role:"system",content:b},{role:"user",content:`Lead: ${e.name}
Property: ${e.address}
Current State: ${e.conversation_state}
Property Condition: ${e.property_condition||"Unknown"}
Timeline: ${e.timeline||"Unknown"}
Motivation: ${e.motivation||"Unknown"}
Price Expectation: ${e.price_expectation||"Unknown"}

Call Context: ${t}

Generate a natural, short voice response. Keep it conversational and friendly.`}]}),a=r.choices[0].message.content||"",n=a.toLowerCase().includes("thank you")||a.toLowerCase().includes("goodbye")||a.toLowerCase().includes("take care"),o={},s=e.conversation_state;return t.toLowerCase().includes("qualified")?s="qualified":t.toLowerCase().includes("offer")&&(s="offer_made"),s!==e.conversation_state&&(o.conversation_state=s),{message:a,shouldEndCall:n,updatedLead:o,nextAction:n?"end_call":"continue",usage:r.usage}}catch(e){throw console.error("[Voice Agent] Error generating response:",e),e}}async function I(e,t){try{let r,a=(await S.chat.completions.create({model:"gpt-5.1",max_tokens:500,messages:[{role:"system",content:"You extract structured insights from call transcripts for real estate wholesaling conversations."},{role:"user",content:`Analyze this call transcript between an AI agent and a property owner:

TRANSCRIPT:
${e}

LEAD INFO:
Name: ${t.name}
Property: ${t.address}

Extract and provide:
1. A brief summary of the call (2-3 sentences)
2. Sentiment (positive/neutral/negative)
3. Was an offer discussed? (yes/no)
4. Next steps discussed
5. Any new information about: property condition, timeline, motivation, or price expectations

Format your response as JSON.`}]})).choices[0].message.content||"{}";try{let e=a.match(/\{[\s\S]*\}/);r=e?JSON.parse(e[0]):{}}catch{r={summary:a,sentiment:"neutral",offerDiscussed:!1,nextSteps:"Follow up required"}}let n={};return r.propertyCondition&&(n.property_condition=r.propertyCondition),r.timeline&&(n.timeline=r.timeline),r.motivation&&(n.motivation=r.motivation),{summary:r.summary||"Call completed",sentiment:r.sentiment||"neutral",offerDiscussed:r.offerDiscussed||!1,nextSteps:r.nextSteps||"Follow up required",leadUpdates:n}}catch(e){return console.error("[Voice Agent] Error extracting insights:",e),{summary:"Call completed",sentiment:"neutral",offerDiscussed:!1,nextSteps:"Follow up required",leadUpdates:{}}}}var O=e.i(32721);let T=_.default.twiml.VoiceResponse;async function A(e){try{let t=await e.formData(),r=e.headers.get("x-twilio-signature")||"",a={};for(let[e,r]of t.entries())a[e]=String(r);if(!(0,O.validateTwilioRequest)(r,e.url,a)){let e=new T;return e.hangup(),new w.NextResponse(e.toString(),{status:403,headers:{"Content-Type":"text/xml"}})}let n=e.nextUrl.searchParams.get("call_id"),o=e.nextUrl.searchParams.get("lead_id"),s=t.get("SpeechResult");console.log(`[Voice Input] CallId: ${n}, Speech: ${s}`);let i=await (0,x.getLeadById)(o),l=await (0,C.getCallById)(n);if(!i||!n){let e=new T;return e.say("Sorry, I couldn't process that. Goodbye."),e.hangup(),new w.NextResponse(e.toString(),{headers:{"Content-Type":"text/xml"}})}let c=await (0,R.getRuntimeSettings)(),u=Number(c.maxCallMinutes||0);if(l&&u>0){let e=new Date(l.created_at),t=new Date,r=Math.floor((t.getTime()-e.getTime())/1e3);if(r>=60*u){let e=new T;return e.say("Thanks for your time today. We'll follow up with next steps via text. Goodbye."),await (0,C.updateCall)(n,{call_status:"completed",duration_seconds:r}),await (0,C.addCallEvent)(n,"max_duration_exceeded",{elapsedSec:r,maxMinutes:u}),new w.NextResponse(e.toString(),{headers:{"Content-Type":"text/xml"}})}}let d=await E(i,s,{leadId:o,phone:i.phone_number,companyName:"Property Direct Cash",agentName:"Alex",mode:"inbound"}),p=`Lead: ${s}
Agent: ${d.message}`;await (0,C.updateCall)(n,{transcript:p,call_status:d.shouldEndCall?"completed":"in_progress"}),await (0,C.addCallEvent)(n,"transcript_update",{speech:s,response:d.message}),d.usage&&await (0,C.addCallEvent)(n,"usage",{tokens:d.usage});let f=new T;if(d.shouldEndCall){f.say(d.message);try{let e=await I(p,i);await (0,C.updateCall)(n,{summary:e.summary,sentiment:e.sentiment,offer_discussed:e.offerDiscussed,next_steps:e.nextSteps}),Object.keys(e.leadUpdates).length>0&&await (0,x.updateLead)(o,e.leadUpdates)}catch{}f.hangup()}else f.gather({timeout:3,action:`/api/twilio/voice/handle-input?call_id=${n}&lead_id=${o}`,method:"POST",speechTimeout:"auto",language:"en-US"}).say(d.message);return new w.NextResponse(f.toString(),{headers:{"Content-Type":"text/xml"}})}catch(t){console.error("[Voice Handle Input] Error:",t);let e=new T;return e.say("An error occurred during the call."),e.hangup(),new w.NextResponse(e.toString(),{headers:{"Content-Type":"text/xml"}})}}e.s(["POST",()=>A],90732);var N=e.i(90732);let M=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/twilio/voice/handle-input/route",pathname:"/api/twilio/voice/handle-input",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/twilio/voice/handle-input/route.ts",nextConfigOutput:"",userland:N}),{workAsyncStorage:P,workUnitAsyncStorage:k,serverHooks:L}=M;function U(){return(0,a.patchFetch)({workAsyncStorage:P,workUnitAsyncStorage:k})}async function D(e,t,a){M.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/twilio/voice/handle-input/route";w=w.replace(/\/index$/,"")||"/";let _=await M.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!_)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:x,params:C,nextConfig:R,parsedUrl:S,isDraftMode:b,prerenderManifest:E,routerServerContext:I,isOnDemandRevalidate:O,revalidateOnlyGenerated:T,resolvedPathname:A,clientReferenceManifest:N,serverActionsManifest:P}=_,k=(0,l.normalizeAppPath)(w),L=!!(E.dynamicRoutes[k]||E.routes[A]),U=async()=>((null==I?void 0:I.render404)?await I.render404(e,t,S,!1):t.end("This page could not be found"),null);if(L&&!b){let e=!!E.routes[A],t=E.dynamicRoutes[k];if(t&&!1===t.fallback&&!e){if(R.experimental.adapterPath)return await U();throw new y.NoFallbackError}}let D=null;!L||M.isDev||b||(D="/index"===(D=A)?"/":D);let $=!0===M.isDev||!L,q=L&&!$;P&&N&&(0,s.setReferenceManifestsSingleton)({page:w,clientReferenceManifest:N,serverActionsManifest:P,serverModuleMap:(0,i.createServerModuleMap)({serverActionsManifest:P})});let j=e.method||"GET",H=(0,o.getTracer)(),F=H.getActiveScopeSpan(),V={params:C,prerenderManifest:E,renderOpts:{experimental:{authInterrupts:!!R.experimental.authInterrupts},cacheComponents:!!R.cacheComponents,supportsDynamicResponse:$,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:R.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>M.onRequestError(e,t,a,I)},sharedContext:{buildId:x}},B=new c.NodeNextRequest(e),K=new c.NodeNextResponse(t),Y=u.NextRequestAdapter.fromNodeNextRequest(B,(0,u.signalFromNodeResponse)(t));try{let s=async e=>M.handle(Y,V).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=H.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=r.get("next.route");if(a){let t=`${j} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":t}),e.updateName(t)}else e.updateName(`${j} ${w}`)}),i=!!(0,n.getRequestMeta)(e,"minimalMode"),l=async n=>{var o,l;let c=async({previousCacheEntry:r})=>{try{if(!i&&O&&T&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let o=await s(n);e.fetchMetrics=V.renderOpts.fetchMetrics;let l=V.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let c=V.renderOpts.collectedTags;if(!L)return await (0,f.sendResponse)(B,K,o,V.renderOpts.pendingWaitUntil),null;{let e=await o.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(o.headers);c&&(t[g.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==V.renderOpts.collectedRevalidate&&!(V.renderOpts.collectedRevalidate>=g.INFINITE_CACHE)&&V.renderOpts.collectedRevalidate,a=void 0===V.renderOpts.collectedExpire||V.renderOpts.collectedExpire>=g.INFINITE_CACHE?void 0:V.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:o.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:a}}}}catch(t){throw(null==r?void 0:r.isStale)&&await M.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:O})},I),t}},u=await M.handleResponse({req:e,nextConfig:R,cacheKey:D,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:E,isRoutePPREnabled:!1,isOnDemandRevalidate:O,revalidateOnlyGenerated:T,responseGenerator:c,waitUntil:a.waitUntil,isMinimalMode:i});if(!L)return null;if((null==u||null==(o=u.value)?void 0:o.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==u||null==(l=u.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});i||t.setHeader("x-nextjs-cache",O?"REVALIDATED":u.isMiss?"MISS":u.isStale?"STALE":"HIT"),b&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,m.fromNodeOutgoingHttpHeaders)(u.value.headers);return i&&L||d.delete(g.NEXT_CACHE_TAGS_HEADER),!u.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,h.getCacheControlHeader)(u.cacheControl)),await (0,f.sendResponse)(B,K,new Response(u.value.body,{headers:d,status:u.value.status||200})),null};F?await l(F):await H.withPropagatedContext(e.headers,()=>H.trace(d.BaseServerSpan.handleRequest,{spanName:`${j} ${w}`,kind:o.SpanKind.SERVER,attributes:{"http.method":j,"http.target":e.url}},l))}catch(t){if(t instanceof y.NoFallbackError||await M.onRequestError(e,t,{routerKind:"App Router",routePath:k,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:O})}),L)throw t;return await (0,f.sendResponse)(B,K,new Response(null,{status:500})),null}}e.s(["handler",()=>D,"patchFetch",()=>U,"routeModule",()=>M,"serverHooks",()=>L,"workAsyncStorage",()=>P,"workUnitAsyncStorage",()=>k],34718)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__bb69136a._.js.map