module.exports=[55156,e=>{"use strict";var t=e.i(46761);function n(){let e=process.env.SUPABASE_SERVICE_ROLE_KEY;return(0,t.createClient)("https://cweluauwjzameqxlcpkj.supabase.co",e)}e.s(["createServiceClient",()=>n])},15794,e=>{"use strict";e.i(86864);var t=e.i(77058),n=e.i(55156);function i(e){return Math.sqrt(e.reduce((e,t)=>e+t*t,0))}async function r(e){let n=new t.default({apiKey:process.env.OPENAI_API_KEY});return(await n.embeddings.create({model:"text-embedding-3-small",input:e})).data[0].embedding}async function a(e,t,c,s=.85,d){let o=(0,n.createServiceClient)(),u=await r(t),l=o.from("cached_responses").select("id,response_text,embedding,intent,market,usage_count,created_at").eq("intent",e);c&&(l=l.eq("market",c));let{data:m}=await l.limit(200),f=Date.now(),_="number"==typeof d&&d>0?24*d*36e5:void 0,p=(m||[]).filter(e=>!_||f-new Date(e.created_at).getTime()<=_).map(e=>{var t;let n,r;return{id:e.id,text:e.response_text,score:(t=e.embedding||[],n=i(u),r=i(t),n&&r?function(e,t){let n=0;for(let i=0;i<Math.min(e.length,t.length);i++)n+=e[i]*t[i];return n}(u,t)/(n*r):0)}});p.sort((e,t)=>t.score-e.score);let g=p[0];if(g&&g.score>=s){let e=(m||[]).find(e=>e.id===g.id);return await o.from("cached_responses").update({usage_count:(e?.usage_count||0)+1,last_used_at:new Date().toISOString()}).eq("id",g.id),{text:g.text,confidence:g.score,id:g.id}}return{text:null,confidence:0}}e.s(["embedQuery",()=>r,"findCachedByEmbedding",()=>a])}];

//# sourceMappingURL=lib_8af6ed8c._.js.map